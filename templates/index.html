<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dra. Thamiris Araujo Est√©tica Avan√ßada</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        body { font-family: 'Poppins', sans-serif; background: #fdfaf9; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 40px; border-radius: 30px; box-shadow: 0 15px 35px rgba(181,131,141,0.1); text-align: center; width: 90%; max-width: 380px; box-sizing: border-box; }
        h1 { color: #b5838d; font-size: 22px; margin-bottom: 25px; line-height: 1.4; }
        select, button { width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; border: 1px solid #f2e9e9; font-size: 16px; box-sizing: border-box; }
        .btn-in { background: #b5838d; color: white; border: none; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .btn-out { background: #6d6875; color: white; border: none; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .btn-in:hover, .btn-out:hover { opacity: 0.9; transform: scale(1.02); }
        .footer-link { display: block; margin-top: 20px; color: #b5838d; text-decoration: none; font-size: 13px; font-weight: 400; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Dra. Thamiris Araujo Est√©tica Avan√ßada</h1>
        <select id="nome">
            <option value="" disabled selected>Quem est√° batendo o ponto? ‚ú®</option>
            {% for colab in colaboradoras %}<option value="{{ colab }}">{{ colab }}</option>{% endfor %}
        </select>
        <button onclick="bater('Entrada')" class="btn-in">üíñ Registrar Entrada</button>
        <button onclick="bater('Sa√≠da')" class="btn-out">üåô Registrar Sa√≠da</button>
        <a href="/painel_gestao" class="footer-link">√Årea Administrativa</a>
    </div>

    <script>
        const CLIN_LAT = -23.5255, CLIN_LON = -46.5273;
        function bater(tipo) {
            const nome = document.getElementById('nome').value;
            if (!nome) { Swal.fire('Ops!', 'Selecione seu nome!', 'warning'); return; }
            navigator.geolocation.getCurrentPosition((pos) => {
                const dist = Math.sqrt(Math.pow(pos.coords.latitude-CLIN_LAT,2)+Math.pow(pos.coords.longitude-CLIN_LON,2));
                if (dist > 0.002) {
                    Swal.fire({
                        title: 'Fora do Endere√ßo?', text: "Voc√™ n√£o est√° na cl√≠nica. Registrar mesmo assim?",
                        icon: 'warning', showCancelButton: true, confirmButtonText: 'Sim', confirmButtonColor: '#b5838d'
                    }).then((r) => { if(r.isConfirmed) enviar(tipo, nome, pos.coords.latitude, pos.coords.longitude); });
                } else { enviar(tipo, nome, pos.coords.latitude, pos.coords.longitude); }
            }, () => { enviar(tipo, nome, null, null); });
        }
        function enviar(tipo, nome, lat, lon) {
            const fd = new FormData(); fd.append('nome', nome); fd.append('tipo', tipo); fd.append('lat', lat); fd.append('lon', lon);
            fetch('/bater_ponto', { method: 'POST', body: fd }).then(r => r.json()).then(data => {
                Swal.fire({ title: data.msg_destaque, text: data.msg_sub, icon: data.fora ? 'warning' : 'success', confirmButtonColor: '#b5838d' });
            });
        }
    </script>
</body>
</html>